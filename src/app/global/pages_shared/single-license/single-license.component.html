<div class="theme-container" *ngIf="host && timezone && businessName; else loaderMain">
	<div class="popup" *ngIf="show_popup" [ngClass]="setPopupBackground()">
		{{ popup_message }} <span class="fas fa-times" (click)="dismissPopup()"></span>
	</div>
	<div class="d-flex align-items-center mb-2 content-section">
		<div class="flex-even">
			<div class="alias-container">
				<ng-container *ngIf="license_data">
					<h1 class="page-title mb-1" *ngIf="!enable_edit_alias; else edit_alias">{{ title }}</h1>
					<mat-icon
						class="edit-alias"
						*ngIf="!enable_edit_alias && !is_view_only"
						(click)="activateEdit(true)"
						matTooltip="Edit license alias">
						edit
					</mat-icon>

                    <ng-template #edit_alias>
                        <form class="edit-alias-form" [formGroup]="update_alias">
                            <h1 class="page-title mb-1"><input matInput formControlName="alias" placeholder="License Alias" /></h1>
                        </form>
                        <mat-icon class="save-alias" *ngIf="enable_edit_alias && !is_view_only" (click)="updateLicenseAlias()" matTooltip="Save license alias"> save </mat-icon>
                    </ng-template>
                </ng-container>
            </div>

			<ng-container *ngIf="license_data">
				<div class="d-flex align-items-center mb-2">
					<p class="sm-text mb-0">{{ license_key }}</p>
					<ng-container>
						<mat-icon class="copy-icon" (click)="copyToClipboard(license_key)" [matTooltip]="tooltipMessage" matTooltipPosition="above">file_copy</mat-icon>
						<mat-icon class="add-tag" (click)="openAddTagModal()" matTooltip="Add tag to this license" matTooltipPosition="above">new_label</mat-icon>
					</ng-container>
				</div>
			</ng-container>

            <div class="d-flex gap-30">
                <div class="d-flex flex-column">
                    <!-- Dealer -->
                    <div class="d-flex hostname" *ngIf="hasAdminPrivileges">
                        <span class="sm-text mr-2"> Dealer: </span>
                        <h5 class="mb-0 sm-text">
                            <ng-container *ngIf="hasAdminPrivileges">
                                <a [routerLink]="dealer_route" target="_blank">
                                    {{ businessName }}
                                </a>
                            </ng-container>
                        </h5>
                    </div>

                    <!-- Hostname -->
                    <div class="d-flex hostname">
                        <span class="sm-text mr-2"> Hostname: </span>
                        <h5 class="mb-0 sm-text">
                            <a [routerLink]="host_route" target="_blank">{{ host.name }}</a>
                        </h5>
                    </div>
                </div>

                <div class="d-flex flex-column">
                    <!-- Timezone -->
                    <div class="d-flex timezone">
                        <span class="sm-text mr-2"> Timezone: </span>
                        <h5 class="sm-text">
                            {{ timezone.name }}
                        </h5>
                    </div>

                    <!-- Business Hours -->
                    <div class="d-flex business-hours">
                        <span class="sm-text mr-2">Business Hours:</span>
                        <h5 (click)="onShowHours()" class="hoverable sm-text">{{ current_operation.day }}: {{ current_operation.period }}</h5>
                    </div>
                </div>
            </div>

			<div class="d-flex tags-container">
				<ng-container *ngIf="tags.length > 0">
					<div
						class="tag sm-text d-flex align-items-center"
						*ngFor="let tag of tags; let i = index"
						[ngClass]="{ dealer: tag.role === 2 }"
						[style.backgroundColor]="tag.tagColor ? tag.tagColor : 'gray'">
						<div class="name" matTooltip="{{ tag.description ? tag.description : 'Edit this tag' }}" (click)="openEditTagModal(i, tag)">
							{{ tag.name }}
						</div>
						<ng-container *ngIf="tag.exclude === 1">
							<mat-icon class="excluded" matTooltip="This tag is excluded">visibility_off</mat-icon>
						</ng-container>
						<ng-container>
							<mat-icon class="remove-btn cursor-pointer" (click)="onRemoveTag(i, tag)" matTooltip="Remove tag on this license">
								close
							</mat-icon>
						</ng-container>
					</div>
				</ng-container>
			</div>
		</div>
		<div class="text-right">
			<button
				mat-button
				mat-raised-button
				class="theme-btn pi-control sm-text mr-2"
				[disabled]="status_check_disabled || !has_host || !has_screen"
				(click)="checkPiStatus()"
				title="Check Status">
				<span class="fas fa-lightbulb"></span> <span class="ml-2 button_text_animation">Check Status</span>
			</button>

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text mr-2 _info"
                [disabled]="!pi_status || pi_updating || is_view_only"
                (click)="pushUpdate()"
                title="Content Update"
            >
                <span class="fas fa-upload"></span> <span class="ml-2 button_text_animation">Content Update</span>
            </button>

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text _cool mr-2"
                [disabled]="!pi_status || pi_updating"
                title="Refetch Player Data"
                (click)="refetchPi()"
            >
                <span class="fas fa-sync"></span> <span class="ml-2 button_text_animation">Refetch Content</span>
            </button>

            <!-- <button
				mat-button
				mat-raised-button
				class="theme-btn pi-control sm-text _primary mr-2"
				[disabled]="!pi_status || pi_updating || is_view_only"
				(click)="updateAndRestart()"
				title="Update System">
				<span class="fas fa-terminal"></span> <span class="ml-2 button_text_animation">Update System</span>
			</button> -->

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text _warning mr-2"
                [disabled]="!pi_status || pi_updating || is_view_only"
                (click)="restartPlayer()"
                title="Reboot Player"
            >
                <span class="fas fa-power-off"></span> <span class="ml-2 button_text_animation">Reboot Player (Software)</span>
            </button>

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text _caution mr-2"
                [disabled]="!pi_status || pi_updating || is_view_only"
                (click)="restartPi()"
                title="Reboot Pi"
            >
                <span class="fas fa-power-off"></span> <span class="ml-2 button_text_animation">Reboot Pi (Device)</span>
            </button>

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text _teal mr-2"
                [disabled]="!pi_status || pi_updating || is_view_only"
                (click)="resetPi()"
                title="Reset Player Data"
            >
                <span class="fas fa-eraser"></span> <span class="ml-2 button_text_animation">Reset Data</span>
            </button>

            <button
                mat-button
                mat-raised-button
                class="theme-btn pi-control sm-text _dark mr-2"
                [disabled]="!pi_status || pi_updating || is_view_only"
                (click)="upgradeToV2()"
                title="Reset Player Data"
                *ngIf="!apps"
            >
                <span class="font-weight-bold">2.0</span> <span class="ml-2 button_text_animation">Upgrade to version 2</span>
            </button>

			<button
				mat-button
				mat-raised-button
				class="theme-btn pi-control sm-text _danger"
				title="Delete License"
				*ngIf="!pi_status"
				(click)="onDeleteLicense()"
				[disabled]="is_view_only || !license_data">
				<span class="fas fa-trash"></span> <span class="ml-2 button_text_animation">Delete License</span>
			</button>
		</div>
	</div>
	<hr class="mb-1 mt-0" />

	<!-- TABS -->
	<div class="row tabs">
		<div class="col-lg-12 min-height-500 custom-mat-tab mt-2">
			<mat-tab-group dynamicHeight (selectedTabChange)="tabSelected($event)">
				<!-- Details Tab -->
				<mat-tab label="Details">
					<ng-container *ngIf="hasLoadedLicenseData; else loader">
						<ng-container *ngIf="has_host && has_screen; else noHostOrScreenData">
							<div class="details-tab-container">
								<div class="row mb-2">
									<!-- Screenshots -->
									<div class="col-lg-12 tab-card">
										<mat-card class="p-3 h-100">
											<!-- Screenshot Area -->	
												<div class="d-flex w-100 w-left">
													<div class="m-auto px-2">
														<div class="d-flex flex-column">
																<button
																	mat-button
																	mat-raised-button
																	class="theme-btn mb-2 btn-title"
																	[disabled]="!pi_status || screenshot_timeout"
																	(click)="screenShotPi()">
																	<span class="fas fa-camera mr-2"></span>
																	Screenshot
																</button>
																<button
																	mat-button
																	mat-raised-button
																	class="theme-btn btn-title"
																	*ngIf="screenshots.length != 0 && !isCurrentUserDealer"
																	[disabled]="screenshot_timeout || clear_screenshots"
																	(click)="clearScreenshots()">
																	<span class="fas fa-times mr-2"></span>
																	Clear
																</button>
														</div>
													</div>		
													
													<div class="vl mr-3 ml-4"></div>
													
													<div class="m-auto horizontal-panel w-right">
														<ng-container *ngIf="screenshots.length != 0; else no_screenshots">
															<div class="screenshots" *ngFor="let s of screenshots">
																<a [href]="s" target="_blank"><img [src]="s" alt="screenshots" /></a>
																<p class="screenshots__text text-center mb-0">{{ s | screenshot }}</p>
															</div>
														</ng-container>
		
														<ng-template #no_screenshots>
															<div class="p-3 text-center">
																<h5 class="text-muted mb-0">No Available Screenshots</h5>
															</div>
														</ng-template>
		
														<div class="loading-overlay d-flex align-items-center" *ngIf="screenshot_timeout">
															<div class="flex-even text-center">
																<h2 class="text-primary"><span class="fas fa-camera"></span></h2>
																<h6 class="text-primary">{{ screenshot_message }}</h6>
															</div>
														</div>
		
														<div class="loading-overlay d-flex align-items-center" *ngIf="clear_screenshots">
															<div class="flex-even text-center">
																<h2 class="text-primary"><span class="fas fa-camera"></span></h2>
																<h6 class="text-primary">Deleting Screenshots. . .</h6>
															</div>
														</div>
													</div>
												</div>
										</mat-card>
									</div>
								</div>

								<div class="d-flex gap-10">
									<div class="w-60">
										<div>
											<div class="first-info d-flex w-100 gap-10 mb-2">
												<!-- Pi and Player Status -->
												<div class="w-60">
													<mat-card class="p-4 h-100">
														<h5 class="mb-0 font-weight-medium">Pi and Player Status</h5>

														<hr class="my-2" />

														<div class="d-flex">
															<!-- Pi Status -->
															<div class="flex-even">
																<span class="title"> Pi Status </span>

																<h5 class="title" [ngClass]="{ good: pi_status, bad: !pi_status }">
																	{{ pi_status ? 'Online' : 'Offline' }}
																</h5>
															</div>

															<!-- Player Status -->
															<div class="flex-even">
																<span class="title"> Player Status </span>

																<h5 class="title" [ngClass]="{ good: player_status, bad: !player_status }">
																	{{ player_status ? 'Online' : 'Offline' }}
																</h5>
															</div>

															<!-- TV Status -->
															<div class="flex-even">
																<span class="title"> TV Status </span>

																<h5 class="title" [ngClass]="{ good: cec_status, bad: !cec_status }">
																	{{ cec_status ? 'ON' : 'OFF' }}
																</h5>
															</div>

															<!-- Display Status -->
															<div class="flex-even">
																<span class="title"> Display Status </span>

																<h5
																	class="title"
																	*ngIf="!isCheckingDisplayStatus; else checkingDisplayStatus"
																	[ngClass]="{ good: display_status === 1, bad: display_status !== 1 }">
																	<ng-container [ngSwitch]="display_status">
																		<ng-container *ngSwitchCase="1">ON</ng-container>
																		<ng-container *ngSwitchCase="2">N/A</ng-container>
																		<ng-container *ngSwitchDefault>OFF</ng-container>
																	</ng-container>
																</h5>

																<ng-template #checkingDisplayStatus>
																	<h5 class="sm-text text-gray">
																		{{ pi_status ? 'Checking ...' : 'N/A' }}
																	</h5>
																</ng-template>
															</div>
														</div>
														<hr class="my-2"/>
														<div class="d-flex">
															<!-- Last Startup -->
															<div class="flex-even last-online">
																<span class="title">Last Startup</span>
																<h5 class="title">{{ lastStartup }}</h5>
															</div>

															<!-- Last Disconnect -->
															<div class="flex-even last-offline">
																<span class="title">Last Disconnect</span>
																<h5 class="title">{{ lastDisconnect }}</h5>
															</div>

															<!-- Last Update -->
															<div class="flex-even last-update">
																<span class="title">Last Update</span>
																<h5 class="title">{{ content_time_update || 'N/A' }}</h5>
															</div>
														</div>
														<hr class="my-2"/>
														<div class="d-flex gap-5">
															<!-- Anydesk -->
															<div class="flex-even">
																<span class="title">Anydesk</span>
																<div class="d-flex align-items-center">
																	<h5 class="d-inline-block title mr-3">
																		{{ anydesk_id ? anydesk_id : 'N/A' }}
																	</h5>

																	<ng-container
																		*ngIf="!anydesk_restarting && anydesk_id; else disabledAnydeskControls">
																		<!-- RESTART ANYDESK SERVICE BUTTON -->
																		<button
																			class="card-button restart-anydesk"
																			(click)="restartAnydesk()"
																			title="Restart Anydesk Service">
																			<span class="fas fa-power-off md-text"></span>
																		</button>

																		<!-- RESET ANYDESK ID BUTTON -->
																		<button
																			*ngIf="hasAdminPrivileges"
																			class="card-button reset-anydesk-id"
																			(click)="onResetAnydeskID()"
																			title="Reset Anydesk ID">
																			<span class="fa fa-exchange md-text"></span>
																		</button>
																	</ng-container>

																	<ng-template #disabledAnydeskControls>
																		<ng-container *ngIf="anydesk_restarting">
																			<button
																				class="card-button restart-anydesk disabled rotate mr-2"
																				title="Anydesk Status">
																				<span class="fas fa-sync md-text"></span>
																			</button>
																		</ng-container>

																		<span class="sm-text text-gray">
																			{{ anydesk_status_text }}
																		</span>
																	</ng-template>
																</div>
															</div>

															<!-- Anydesk Password -->
															<div class="flex-even last-update">
																<span class="title">Anydesk Password</span>
																<h5 class="title">{{ splitKey(license_id) }}</h5>
															</div>

															<!-- TV Brand -->
															<div class="flex-even tv-brand">
																<span class="title">TV Brand</span>
																<div class="d-flex align-items-center">
																	<h5 class="title">{{ tv_brand | titlecase }}</h5>
																	<mat-icon class="clickable sm-text" (click)="openUpdateTvBrandDialog()">
																		{{ is_editing_tv_brand ? 'save' : 'edit' }}
																	</mat-icon>
																</div>
															</div>
														</div>
													</mat-card>
												</div>

												<!-- Screen Info -->
												<div class="w-40">
													<mat-card class="h-100 p-4">
														<ng-container *ngIf="hasLoadedScreenData; else loaderSmall">
															<h5 class="mb-0 font-weight-medium">Screen Info</h5>

															<hr class="my-2" />

															<div class="d-flex">
																<!-- Screen Name -->
																<div class="flex-even">
																	<span class="title">Screen Name</span>
																	<a [routerLink]="screen_route" target="_blank">
																		<h5 class="hoverable title">
																			{{ screen.screen_title ? (screen.screen_title | titlecase) : 'N/A' }}
																		</h5>
																	</a>
																</div>

																<div class="flex-even">
																	<span class="title">Screen Template</span>
																	<h5 class="title">
																		{{ screen.assigned_template ? screen.assigned_template : 'N/A' }}
																	</h5>
																</div>

																<div class="flex-even" *ngIf="screen_type">
																	<span class="title">Screen Type</span>
																	<h5 class="title">
																		{{ screen_type.name ? (screen_type.name | titlecase) : 'N/A' }}
																	</h5>
																</div>
															</div>

															<hr class="my-2" />

															<!-- Screen Playlists -->
															<div>
																<span class="title">Screen Playlists</span>
																<div>
																	<ul class="m-0 p-0 list-unstyled">
																		<li *ngFor="let zone of zone_playlists">
																			<span
																				class="fas fa-circle mr-2 align-middle d-inline-block"
																				style="font-size: 6px"></span>

																			<ng-container
																				*ngIf="zone.link !== '/administrator/playlists/null'; else no_url">
																				<a [routerLink]="zone.link" target="_blank">
																					<h5 class="hoverable d-inline-block align-middle title m-0">
																						{{ zone.name }} - {{ zone.playlist_name }}
																					</h5>
																				</a>
																			</ng-container>

																			<ng-template #no_url>
																				<h5 class="d-inline-block align-middle title m-0">
																					{{ zone.name }} - No Playlist
																				</h5>
																			</ng-template>
																		</li>
																	</ul>
																</div>
															</div>
														</ng-container>
													</mat-card>
												</div>
											</div>

											<!-- Other Details -->
											<div class="w-100 mb-3">
												<mat-card class="p-4">
													<h5 class="mb-0 font-weight-medium">Other Details</h5>
													<hr class="my-2" />

													<div class="row">
														<!-- Notes -->
														<div class="col-lg-4" *ngIf="!isCurrentUserDealer">
															<div class="notes">
																<span class="title">Host Notes </span>
																<ng-container *ngIf="host_notes; else noNotes"></ng-container>
																	<p (click)="onShowNotes()" class="title hoverable">
																		{{  host_notes | substring : 200 }}
																	</p>
															</div>
														</div>

														<ng-template #noNotes>
															<p class="title">No notes available</p>
														</ng-template>

														<!-- Pictures -->
														<div class="col-lg-5">
															<span class="title">Pictures</span>

															<div class="pictures__main d-flex">
																<ng-container *ngIf="images.length; else noPictures">
																	<div *ngFor="let i of images">
																		<a [href]="i.url" target="_blank">
																			<img
																				[src]="i.url"
																				class="mr-2 mb-2 pictures__main-pictures"
																				alt="pictures"
																				matTooltip="{{ i.dateCreated | date : 'MMMM d, y' }} {{
																					i.filename
																				}}" />
																		</a>
																	</div>
																</ng-container>
															</div>
														</div>

														<ng-template #noPictures>
															<p class="title">No pictures available</p>
														</ng-template>

														<!-- Ticket -->
														<div class="col-lg-3">
															<span class="title">Tickets</span>
															<ng-container *ngIf="!no_support_data; else noTicket">
																<p (click)="onShowTickets()" class="title hoverable">View Tickets...</p>
															</ng-container>
														</div>

														<ng-template #noTicket>
															<p class="title">No tickets available</p>
														</ng-template>
													</div>
												</mat-card>
											</div>
										</div>
									</div>

									<div class="w-40">
										<div>
											<!-- System Info -->
											<div class="w-100 mb-3">
												<mat-card class="p-4">
													<h5 class="mb-0 font-weight-medium">System Info</h5>

													<hr class="my-2" />

													<!-- Speedtest -->
													<div class="align-items-center">
														<div class="last-speedtest-date mb-3">
															<span class="title">Last Speedtest</span>
															<div>
																<h5 class="d-inline-block mr-4 title">
																	{{ internet_connection.date ? internet_connection.date : 'N/A' }}
																</h5>

                                                                <ng-container *ngIf="!speedtest_running; else disable_speedtest_btn">
                                                                    <button
                                                                        *ngIf="license_data.speedtestSettings == 1"
                                                                        class="card-button"
                                                                        (click)="internetSpeedTest()"
                                                                        title="Test Internet Speed"
                                                                    >
                                                                        <span class="fas fa-sync md-text"></span>
                                                                    </button>
                                                                </ng-container>

                                                                <ng-template #disable_speedtest_btn>
                                                                    <button class="card-button disabled rotate mr-2" title="Speedtest Running">
                                                                        <span class="fas fa-sync md-text"></span>
                                                                    </button>

                                                                    <span class="sm-text text-gray"> Speed Test Running </span>
                                                                </ng-template>
                                                            </div>
                                                        </div>

														<div class="d-flex">
															<!-- Connection -->
															<div class="flex-even">
																<span class="title">Connection Status</span>
																<ng-container *ngIf="apps && apps.server; else netstatus_v1">
																	<h5
																		class="title"
																		*ngIf="internet_connection.status && pi_status; else offline_net"
																		[ngClass]="internet_connection.status == 'Good' ? 'good' : 'slow'">
																		{{ internet_connection.status }}
																	</h5>

																	<ng-template #offline_net>
																		<h5 *ngIf="license_data.internetSpeed" class="bad sm-text">Offline</h5>
																	</ng-template>
																</ng-container>

																<ng-template #netstatus_v1>
																	<h5
																		class="title"
																		[ngClass]="license_data.internetSpeed == 'Good' ? 'good' : 'slow'">
																		{{ license_data.internetSpeed }}
																	</h5>
																</ng-template>
															</div>

															<!-- Connection Type -->
															<div class="flex-even connection-type">
																<span class="title">Connection Type</span>
																<h5 class="title">
																	{{ license_data.internetType ? license_data.internetType : 'N/A' }}
																</h5>
															</div>

															<!-- Download Speed -->
															<div class="flex-even storage">
																<span class="title">Download Speed</span>
																<h5 class="title">{{ internet_connection.downloadMbps }}</h5>
															</div>


															<!-- Upload Speed -->
															<div class="flex-even storage">
																<span class="title">Upload Speed</span>
																<h5 class="title">{{ internet_connection.uploadMbps }}</h5>
															</div>

															<!-- Storage -->
															<div class="flex-even storage">
																<span class="title">Storage</span>
																<h5 class="title">{{ storage_capacity ? storage_capacity : 'N/A' }}</h5>
															</div>
														</div>
													</div>

													<hr class="my-2" />

													<div class="d-flex">
														<!-- Memory -->
														<div class="flex-even memory">
															<span class="title">RAM/Memory</span>
															<h5 class="title">{{ license_data.memory ? license_data.memory : 'N/A' }}</h5>
														</div>

														<!-- Player Version -->
														<div class="flex-even player-version">
															<span class="title">Player Version</span>
															<h5 class="title">{{ apps && apps.server ? 'Version 2' : 'Version 1' }}</h5>
														</div>

														<!-- Player Server -->
														<div class="flex-even player-server-version">
															<span class="title">Server Version</span>
															<h5 class="title">{{ apps && apps.server ? apps.server : 'N/A' }}</h5>
														</div>

														<!-- Player UI -->
														<div class="flex-even ui-version">
															<span class="title">UI Version</span>
															<h5 class="title">{{ apps && apps.ui ? apps.ui : 'N/A' }}</h5>
														</div>

														<!-- Pi Version -->
														<div class="flex-even storage">
															<span class="title">Pi Version</span>
															<h5 class="title">{{ apps && apps.rpi_model ? apps.rpi_model : 'N/A' }}</h5>
														</div>
													</div>

													<hr class="my-2" />

													<div class="d-flex">
														<!-- Player UI -->
														<div class="flex-even chromium-version">
															<span class="title">Chromium Version</span>
															<h5 class="title">{{ apps && apps.chromium ? apps.chromium : 'N/A' }}</h5>
														</div>

														<ng-container *ngIf="isCurrentUserAdmin">
															<div class="flex-even">
																<span class="title">Current IP</span>
																<br />
																<h5 class="title">
																	{{ license_data.publicIP ? license_data.publicIP : 'N/A' }}
																</h5>
															</div>
															<div class="flex-even">
																<span class="title">Previous IP</span>
																<br />
																<h5 class="title">
																	{{ license_data.prevPublicIP ? license_data.prevPublicIP : 'N/A' }}
																</h5>
															</div>
														</ng-container>
													</div>
												</mat-card>
											</div>
										</div>
									</div>
								</div>
							</div>
						</ng-container>
					</ng-container>
				</mat-tab>

                <!-- Content Tab -->
                <mat-tab label="Content">
                    <ng-container *ngIf="has_host && has_screen; else noHostOrScreenData">
                        <div class="content-tab-container">
                            <div class="container-fluid">
                                <div class="row">
                                    <!-- Playlist Info -->
                                    <div class="col-lg-3">
                                        <div class="playlist-details">
                                            <div>
                                                <h2>{{ current_zone_name_selected }} Section</h2>
                                            </div>
                                            <div class="row">
                                                <div class="col-lg-10">
                                                    <a class="playlist-name" [routerLink]="playlist_route">{{ screen_zone.playlistName }}</a>
                                                </div>
                                            </div>
                                            <br />
                                            <div>
                                                <span class="sm-text"><b>Duration Breakdown</b></span>
                                            </div>
                                            <div class="hosts-duration">
                                                <span class="sm-text">Hosts: {{ duration_breakdown_text.hosts }}</span>
                                            </div>
                                            <div class="advertisers-duration">
                                                <span class="sm-text">Advertisers: {{ duration_breakdown_text.advertisers }}</span>
                                            </div>
                                            <div class="fillers-duration">
                                                <span class="sm-text">Filler: {{ duration_breakdown_text.fillers }}</span>
                                            </div>
                                            <div class="feeds-duration">
                                                <span class="sm-text">Feeds: {{ duration_breakdown_text.feeds }}</span>
                                            </div>
                                            <div class="others-duration">
                                                <span class="sm-text">Other: {{ duration_breakdown_text.others }}</span>
                                            </div>
                                            <div class="total-duration">
                                                <span class="sm-text"
                                                    ><b>Total playtime: {{ duration_breakdown_text.total }}</b></span
                                                >
                                            </div>
                                            <ng-template #no_playlist>
                                                <span class="sm-text">No playlist for this zone</span>
                                            </ng-template>
                                        </div>
                                    </div>

                                    <!-- Minimap -->
                                    <div class="col-lg-3">
                                        <div class="minimap">
                                            <app-template-minimap
                                                *ngIf="template_data; else loader"
                                                [larger]="false"
                                                [zone_focus]="'main'"
                                                [is_text_displayed]="true"
                                                [is_interactive]="true"
                                                [template_data]="template_data"
                                                [height]="'180px'"
                                                [width]="minimap_width"
                                            >
                                            </app-template-minimap>

                                            <!-- Background Section Toggle -->
                                            <div class="toggle-background-zone" *ngIf="has_background_zone">
                                                <mat-slide-toggle [checked]="background_zone_selected" (click)="onSelectBackgroundZone($event)">
                                                    Select Background Section
                                                </mat-slide-toggle>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Assets Breakdown -->
                                    <div class="col-lg-3">
                                        <div class="assets-chart-container">
                                            <canvas id="assetsBreakdown" height="250"></canvas>
                                        </div>
                                    </div>

                                    <!-- Duration Breakdown -->
                                    <div class="col-lg-3">
                                        <div class="duration-chart-container">
                                            <canvas id="durationBreakdown" height="250"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <br />

                            <mat-card class="filters-section mb-4">
                                <div class="d-flex align-items-center no-gutters full-width">
                                    <!-- PLAYLIST CONTENT SCHEDULE STATUS FILTERS -->
                                    <div class="playlist-content-schedule-status-filters mr-2">
                                        <button mat-button mat-raised-button [matMenuTriggerFor]="playlistContentScheduleStatusFilters" mat-raised-button class="theme-btn">
                                            <span class="button-label">Content Schedule Status</span>
                                            <span class="fas fa-angle-down ml-2"></span>
                                        </button>
                                        <mat-menu #playlistContentScheduleStatusFilters="matMenu">
                                            <button
                                                *ngFor="let status of content_schedule_statuses"
                                                mat-menu-item
                                                (click)="onFilterContent('schedule_status', status.toLowerCase())"
                                                [ngClass]="content_filters.includes(status.toLowerCase()) ? 'selected-filter' : ''"
                                            >
                                                {{ status | titlecase }}
                                            </button>
                                        </mat-menu>
                                    </div>

                                    <!-- CONTENT OWNER TYPE FILTERS -->
                                    <div class="content-owner-type-filters mr-2">
                                        <button mat-button mat-raised-button [matMenuTriggerFor]="ownerTypeFilters" mat-raised-button class="theme-btn">
                                            <span class="button-label">Owner Type</span>
                                            <span class="fas fa-angle-down ml-2"></span>
                                        </button>
                                        <mat-menu #ownerTypeFilters="matMenu">
                                            <button *ngFor="let type of content_owner_types" mat-menu-item (click)="onFilterContent('owner', type.toLowerCase())">
                                                {{ type | titlecase }}
                                            </button>
                                        </mat-menu>
                                    </div>

                                    <!-- CONTENT TYPE FILTERS -->
                                    <div class="content-type-filters mr-2">
                                        <button mat-button mat-raised-button [matMenuTriggerFor]="contentTypeFilters" mat-raised-button class="theme-btn">
                                            <span class="button-label">Content Type</span>
                                            <span class="fas fa-angle-down ml-2"></span>
                                        </button>
                                        <mat-menu #contentTypeFilters="matMenu">
                                            <button *ngFor="let type of content_types" mat-menu-item (click)="onFilterContent('content_type', type.toLowerCase())">
                                                {{ type | titlecase }}
                                            </button>
                                        </mat-menu>
                                    </div>

                                    <!-- SELECTED FILTERS -->
                                    <ng-container *ngIf="content_filters.length > 0">
                                        <div class="current-filters d-flex">
                                            <div class="filter d-flex align-items-center mr-2" *ngFor="let filter of content_filters">
                                                <div class="name">{{ filter.name | titlecase }}</div>
                                                <div class="remove-btn cursor-pointer" (click)="onRemoveContentFilter(filter.name.toLowerCase())">
                                                    <mat-icon class="no-select">close</mat-icon>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>

                                    <!-- RESET FILTERS -->
                                    <div class="reset-filters mr-2">
                                        <button
                                            mat-button
                                            mat-raised-button
                                            mat-raised-button
                                            class="theme-btn btn-danger"
                                            (click)="onResetFilters()"
                                            [disabled]="content_filters.length === 0"
                                        >
                                            <span class="button-label">Reset Filters</span>
                                            <span class="fas fa-times ml-2"></span>
                                        </button>
                                    </div>

                                    <!-- CONTENT SEARCH FIELD -->
                                    <div class="content-search mr-2">
                                        <div class="flex-even form-field">
                                            <mat-form-field class="full-width" appearance="fill">
                                                <mat-label>Search a content</mat-label>
                                                <input matInput type="text" placeholder="Search a File" [formControl]="content_search_control" />
                                            </mat-form-field>
                                            <span class="fas fa-search"></span>
                                        </div>
                                    </div>
                                </div>
                            </mat-card>

                            <!-- Media Viewer -->
                            <div class="row no-gutters" *ngIf="has_playlist">
                                <div class="col-md-1" *ngFor="let a of content_per_zone[selected_zone_index].contents; let i = index">
                                    <div class="mr-2">
                                        <app-thumbnail-card
                                            (click)="onOpenMediaViewer(content_per_zone[selected_zone_index].contents, i)"
                                            [content_id]="a.content_id"
                                            [disconnect_to_socket]="thumb_no_socket"
                                            [classification]="a.classification"
                                            [file_url]="a.file_url"
                                            [filename]="a.file_type !== 'feed' ? a.file_name : a.title"
                                            [filetype]="a.file_type"
                                            [handle]="a.handler_id"
                                            [image_uri]="a.thumbnail"
                                            [is_converted]="a.is_converted"
                                            [is_fullscreen]="a.is_fullscreen"
                                            [is_protected]="a.is_protected"
                                            [is_scheduled_content]="a.playlist_content_schedule.type === 3"
                                            [sequence]="a.seq"
                                            [is_view_only]="true"
                                            [uuid]="a.uuid"
                                            [zone_content]="true"
                                        >
                                        </app-thumbnail-card>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                </mat-tab>

                <!-- Terminal Tab -->
                <mat-tab label="Terminal" *ngIf="isCurrentUserAdmin">
                    <ng-container *ngIf="has_host && has_screen; else noHostOrScreenData">
                        <div class="terminal-area mt-4">
                            <div class="row">
                                <div class="col-lg-7">
                                    <h3>Remote Terminal</h3>
                                    <p class="sm-text mb-3">Write a short script and send it to the player to run.</p>
                                    <div class="terminal">
                                        <div class="entered-scripts">
                                            <div *ngFor="let s of terminal_entered_scripts">
                                                <p class="sm-text text-primary">> {{ s }}</p>
                                            </div>
                                        </div>

                                        <div class="d-flex">
                                            <input [(ngModel)]="terminal_value" placeholder="Enter Command" class="terminal-text-entry mb-3 flex-even" />
                                            <button
                                                (click)="submitTerminalCommand()"
                                                class="terminal-submit-button"
                                                [disabled]="terminal_value === undefined || terminal_value === ''"
                                            >
                                                Run <span class="fas fa-play sm-text ml-2"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-5"></div>
                            </div>
                        </div>
                    </ng-container>
                </mat-tab>

                <!-- Activity Tab -->
                <mat-tab label="Activity" *ngIf="isCurrentUserAdmin">
                    <ng-container *ngIf="activities && activities.length > 0; else noLicenseActivity">
                        <div class="row mt-4">
                            <div class="col-lg-4">
                                <mat-card class="p-3 mb-3" *ngFor="let a of activities">
                                    <h4>{{ a.activityDescription }}</h4>
                                    <p class="sm-text">Initiated by {{ a.initiatedBy }} on {{ a.dateCreated | date : "MMM dd, y hh:mm a" }}</p>
                                </mat-card>
                            </div>
                        </div>
                    </ng-container>
                </mat-tab>

                <!-- Settings Tab -->
                <mat-tab label="Settings" *ngIf="license_data">
                    <div class="row mt-4">
                        <div class="col-lg-5">
                            <ng-container *ngIf="isCurrentUserAdmin">
                                <!-- SCREENSHOT SETTINGS -->
                                <mat-card class="p-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-even">
                                            <h4>Enable Scheduled Screenshot</h4>
                                            <p class="sm-text mb-0">
                                                For players with limited internet data, Disabling this feature is recommended. Manual screenshot will still be available of use.
                                            </p>
                                        </div>
                                        <div class="ml-5 text-right">
                                            <mat-slide-toggle (change)="disableScreenshot($event)" [checked]="license_data.screenshotSettings == 1 ? true : false">
                                            </mat-slide-toggle>
                                        </div>
                                    </div>
                                </mat-card>

                                <!-- SPEEDTEST SETTINGS -->
                                <mat-card class="p-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-even">
                                            <h4>Enable Speedtest</h4>
                                            <p class="sm-text mb-0">
                                                Internet Speedtest uses almost 200MB of internet data. For players with limited internet data, disabling this feature is
                                                recommended.
                                            </p>
                                        </div>
                                        <div class="ml-5 text-right">
                                            <mat-slide-toggle (change)="disableSpeedtest($event)" [checked]="license_data.speedtestSettings == 1 ? true : false">
                                            </mat-slide-toggle>
                                        </div>
                                    </div>
                                </mat-card>

                                <!-- EMAIL SETTINGS -->
                                <mat-card class="p-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-even">
                                            <h4>Enable Email Settings</h4>
                                            <p class="sm-text mb-0">Allows the dealer to receive EMAIL notifications from this license when the device is offline.</p>
                                        </div>
                                        <div class="ml-5 text-right">
                                            <mat-slide-toggle (change)="onUpdateNotificationSettings($event, 'email')" [checked]="license_data.emailSettings == 1 ? true : false">
                                            </mat-slide-toggle>
                                        </div>
                                    </div>
                                </mat-card>

                                <!-- NOTIFICATION SETTINGS -->
                                <mat-card class="p-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-even">
                                            <h4>Enable Notification Settings</h4>
                                            <p class="sm-text mb-0">Allows the dealer to receive ALERT notifications from this license when the device is offline.</p>
                                        </div>
                                        <div class="ml-5 text-right">
                                            <mat-slide-toggle
                                                (change)="onUpdateNotificationSettings($event, 'notification')"
                                                [checked]="license_data.notificationSettings == 1 ? true : false"
                                            >
                                            </mat-slide-toggle>
                                        </div>
                                    </div>
                                </mat-card>

                                <!-- RESOURCE LOG SETTINGS -->
                                <mat-card class="p-4 mb-3">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-even">
                                            <h4>Enable Resource Log Sending</h4>
                                            <p class="sm-text mb-0">
                                                This will send the player's CPU and RAM average usage every 2 hours. Requires data usage, toggle off to disable.
                                            </p>
                                        </div>
                                        <div class="ml-5 text-right">
                                            <mat-slide-toggle (change)="disableResource($event)" [checked]="license_data.resourceSettings == 1 ? true : false"> </mat-slide-toggle>
                                        </div>
                                    </div>
                                </mat-card>
                            </ng-container>

                            <!-- FASTEDGE DCP SETTINGS -->
                            <mat-card class="px-4 pb-0 mb-3">
                                <div class="d-flex align-items-center">
                                    <div class="flex-even mb-3">
                                        <h4>Enable FE-DCP Tool</h4>
                                        <p class="sm-text">Enables DCP Monitoring Tool. Enter password to enable.</p>
                                    </div>
                                    <div *ngIf="fastEdgeSettingsSaving">
                                        <mat-spinner [diameter]="20"></mat-spinner>
                                    </div>
                                </div>

                                <div class="fast-edge-setting-form-wrapper">
                                    <form [formGroup]="fastEdgeSettings">
                                        <div class="d-flex">
                                            <div class="flex-even">
                                                <mat-form-field class="w-100" appearance="fill">
                                                    <mat-label>Enter Password*</mat-label>
                                                    <input matInput formControlName="password" type="password" />
                                                </mat-form-field>
                                            </div>
                                            <div class="pt-3 ml-5 text-right">
                                                <mat-slide-toggle
                                                    (change)="toggleFastEdgeTool($event)"
                                                    [disabled]="!fastEdgeSettings.valid"
                                                    [checked]="license_data.fastEdgeMonitoringTool == 1 ? true : false"
                                                >
                                                </mat-slide-toggle>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </mat-card>
                        </div>

                        <ng-container *ngIf="hasAdminPrivileges">
                            <div class="col-lg-7">
                                <mat-card class="p-4">
                                    <h4 class="mb-4">Additional Settings</h4>

                                    <ng-container *ngIf="license_data && additional_license_settings_form">
                                        <form [formGroup]="additional_license_settings_form" (ngSubmit)="saveAdditionalLicenseSettings()">
                                            <div class="row flex-column">
                                                <div *ngFor="let control of additional_license_settings_form_fields" class="col-lg-6">
                                                    <ng-container *ngIf="control.type === 'number' || control.type === 'text'; else otherFieldTypes">
                                                        <mat-form-field class="full-width">
                                                            <mat-label>{{ control.label }}</mat-label>

                                                            <input
                                                                matInput
                                                                appearance="fill"
                                                                placeholder="Enter number of seconds, ex: 20"
                                                                [formControlName]="control.form_control_name"
                                                                [type]="control.type"
                                                            />
                                                        </mat-form-field>
                                                    </ng-container>

                                                    <ng-template #otherFieldTypes>
                                                        <ng-container *ngIf="control.type === 'time'">
                                                            <div class="d-flex align-items-center reboot-time">
                                                                <span>{{ control.label }}:</span>

                                                                <ngb-timepicker [formControlName]="control.form_control_name" [meridian]="true" [size]="'small'"> </ngb-timepicker>
                                                                <ng-container *ngIf="control"></ng-container>
                                                                <mat-icon class="remove-reboot-btn" (click)="onRemoveRebootTime(control.form_control_name)">delete</mat-icon>
                                                            </div>
                                                        </ng-container>
                                                    </ng-template>
                                                </div>
                                            </div>

                                            <div class="d-flex">
                                                <button
                                                    mat-button
                                                    mat-raised-button
                                                    class="theme-btn mr-2"
                                                    [disabled]="saving_license_settings || !has_unsaved_additional_settings"
                                                >
                                                    Save
                                                </button>
                                                <app-spinner *ngIf="saving_license_settings" [diameter]="20"></app-spinner>
                                            </div>
                                        </form>
                                    </ng-container>
                                </mat-card>
                            </div>
                        </ng-container>
                    </div>
                </mat-tab>

                <!-- Resource Tab -->
                <mat-tab label="Resource" *ngIf="isCurrentUserAdmin">
                    <ng-template matTabContent>
                        <app-resource-tab [license_id]="license_id" [screen]="screen" [realtime_data]="realtime_data"> </app-resource-tab>
                    </ng-template>
                </mat-tab>

                <!-- Installation Tab -->
                <mat-tab label="Installation">
                    <ng-template matTabContent>
                        <app-installation-tab [license_id]="license_id"> </app-installation-tab>
                    </ng-template>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>

    <ng-template #loader>
        <div class="loader text-center py-5 d-flex align-items-center vh-50">
            <div class="w-100">
                <mat-spinner></mat-spinner>
                <h3 class="mt-4 mb-2">Please Wait</h3>
                <p class="sm-text">Retrieving license data ...</p>
            </div>
        </div>
    </ng-template>

    <ng-template #loading>
        <div class="loader text-center py-5 d-flex align-items-center vh-50" *ngIf="!no_screen_assigned; else no_screen">
            <div class="w-100">
                <mat-spinner></mat-spinner>
                <h3 class="mt-4 mb-2">Please Wait</h3>
            </div>
        </div>
    </ng-template>

    <ng-template #no_data>
        <div class="col-lg-12 text-center">
            <div class="loader text-center py-5 d-flex align-items-center vh-50">
                <div class="w-100">
                    <h3 class="mt-4 mb-2">No Data Found</h3>
                    <p class="sm-text">There are no recorded plays of content during this date.</p>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template #no_zone>
        <div class="col-lg-12 text-center">
            <div class="loader text-center py-5 d-flex align-items-center vh-50">
                <div class="w-100">
                    <h3 class="mt-4 mb-2">No Data Found</h3>
                    <p class="sm-text">Assign a screen first, to see its contents.</p>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template #no_screen>
        <div class="no-screen vh-50 row align-items-center justify-content-center">
            <div class="col-lg-12 text-center">
                <span class="fa fa-tv"></span>
                <br />
                <div class="captions mt-3">No Screen Assigned</div>
            </div>
        </div>
    </ng-template>
</div>

<ng-template #noHostOrScreenData>
    <div class="no-screen vh-50 row align-items-center justify-content-center">
        <div class="col-lg-12 text-center">
            <span class="fa fa-tv"></span>
            <br />
            <div class="captions mt-3">
                {{ license_data ? "No Host or Screen Assigned" : "No License Data" }}
            </div>
        </div>
    </div>
</ng-template>

<ng-template #noLicenseActivity>
    <div class="no-screen vh-50 row align-items-center justify-content-center">
        <div class="col-lg-12 text-center">
            <span class="fa fa-tv"></span>
            <br />
            <div class="captions mt-3">No License Activity</div>
        </div>
    </div>
</ng-template>

<ng-template #loaderMain>
	<div class="h-80 d-flex justify-content-center align-items-center">
		<app-spinner></app-spinner>
	</div>
</ng-template>

<ng-template #loaderSmall>
    <app-spinner [diameter]="60"></app-spinner>
</ng-template>
